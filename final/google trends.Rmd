---
title: "google trends"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r step1, warning=FALSE, include=FALSE}
library(readxl)
CovidData <- read.csv("tidycovid19.csv")
```

```{r step2 date setup, message=FALSE, warning=FALSE, include=FALSE}
library(lubridate)
CovidData$date = as.Date(parse_date_time(CovidData$date,orders=c("y","ym","ymd")))

```

```{r step2 obtain cases per day, message=FALSE, warning=FALSE, include=FALSE}
library(dplyr)
firstdiff <- function(x) {
  shifted <- c(0,x[1:(length(x)-1)])
  result = x-shifted
  which_negative = which(result<0)
  result[which_negative] = NA
  return(result)
}

```

```{r step 2 task2, message=FALSE, warning=FALSE, include=FALSE}
library(stringr)
EuropeAmericaDataPostFeb6 <- {CovidData %>% 
    filter( ( str_detect(region, "America") | str_detect(region, "Europe") ) & (date > as.Date("2020-02-06")) )}
```

```{r daily confirmed, include=FALSE}
# Add a column so we can see the daily confirmed cases of covid19
EuropeAmericaDataPostFeb6 <- EuropeAmericaDataPostFeb6 %>% 
  mutate(daily_confirmed = firstdiff(confirmed))
```

```{r US Data, echo=FALSE, message=FALSE, warning=FALSE}
library(ggplot2)
USResidentialData <- EuropeAmericaDataPostFeb6 %>% filter(country %in% c("United States"))

USResPlot <- ggplot(USResidentialData, aes(x = date, y = gcmr_residential)) + geom_smooth(size = 0.5)
##print(USResPlot)

#Data obtained from google trends, searched terms "take-out (cuisine)" for the US in the past 12 months
USTakeoutSearch <- read.csv("USTakeoutSearchGtrends.csv")
USTakeoutSearch <- USTakeoutSearch %>% mutate(date = as.Date(parse_date_time(USTakeoutSearch$Week,c("d/m/y"))))

USTakeoutPlot <- ggplot(USTakeoutSearch, aes(x = date, y = Take.out...United.States.)) + geom_smooth(size = 0.5)

##print(USTakeoutPlot)

USTakeoutResData <- USTakeoutSearch
USTakeoutResData <- USResidentialData %>% filter(date %in% USTakeoutSearch$date) %>% select(date, gcmr_residential)

USTakeoutResData <- USTakeoutResData %>% mutate(. = (USTakeoutSearch %>% filter(date %in% USTakeoutResData$date) %>% select(Take.out...United.States.)))

#The USTakeoutResData has the gcmr residential and the takeout interest in the US for the timeframe 09/02/2020 to 20/09/2020.


```

```{r USTakeoutResPlot, echo=FALSE, message=FALSE, warning=FALSE}
USTakeoutResPlot <- ggplot(USTakeoutResData, aes(x = gcmr_residential, y = Take.out...United.States.)) + geom_point(size = 0.5) + geom_smooth(method = 'lm', formula = y~x)+ ylab("Interest in 'Take out' searches over time ") + xlab("Activity in places of residence\n(as a percentage*100 change relative to the baseline period)") + ggtitle("Interest in 'Take out' against the time spent in places of\nresidence in the US") + ylim(c(0,100))

# ylabel Interest over time: Numbers represent search interest relative to the highest point on the chart for the given region and time. A value of 100 is the peak popularity for the term. A value of 50 means that the term is half as popular. A score of 0 means there was not enough data for this term.

print(USTakeoutResPlot)

#summary(lm(data = USTakeoutResData, Take.out...United.States. ~ gcmr_residential))
```

Despite the U.S. government having 0 lockdown measures in place we have seen an increase of activity in the places of residence. At the first peak of the daily confirmed cases of COVID-19 (refer to the graph of the Daily Confirmed Cases of COVID-19 as a % of the total population) around April we can see that the citizens in the U.S. were cautious and the activity within residences peaked (refer to the gcmr_residence against date plot). Due to the increased activity in residences, we have noticed a positive relationship between the activity in residences and the interest in 'Take out' searches in Google trends.

To capture the loss of business in the hospitality sector (mainly restaurents), I would recommend Omnicorp to expand into delivery of food from their current restaurants. This will hopefully recover the business that is lost due to COVID-19 whilst keeping the spread of COVID-19 to a minimum as customers will be eating at home.