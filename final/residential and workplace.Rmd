---
title: "Residential and Workplaces"
author: "Becky Waller"
urlcolor: blue
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction & data
Since the large impacts of the pandemic on OmniCorp, particularly in the retail and hospitality sectors, we are interested in the effects of lockdown and other government interventions and how/why these might be different in different countries.

In the following, we will use the [dataset](https://moodle.warwick.ac.uk/mod/resource/view.php?id=1023429) "tidycovid19.csv", downloaded from the tidycovid19 R package on 24th September 2020. Descriptions of the different variables found in the data relating to the current epidemic and further details of the package can be found at this [website](https://joachim-gassen.github.io/tidycovid19/) (Gassen 2020).

We look at how the frequency of people visiting residential places and workplaces has changed during the pandemic for countries in Europe and America. In particular we study the `gcmr_residential` `gcmr_workplaces` variables from a community mobility report (Google, 2020). The variables are expressed as a percentage*100 change relative to the baseline period Jan 3 - Feb 6, 2020. However, we take the data from Feb 7 onwards as we want to look at the average percentage change in the frequency of people's visits to these places, and don't want to include the baseline in this mean.

```{r read, message=FALSE, echo=FALSE, warning=FALSE}
library(dplyr)
library(tidyr)
library(readxl)
CovidData <- read.csv("tidycovid19.csv")

library(lubridate)
CovidData <- CovidData %>%
  mutate(date = as.Date(parse_date_time(CovidData$date,orders=c("y","ym","ymd"))))
```

```{r EURUSAdata, message=FALSE, echo=FALSE, warning=FALSE}
library(stringr)
EURUSA <- {CovidData %>% 
    filter( ( str_detect(region, "America") | str_detect(region, "Europe") ) ) %>%
    select(country, date, gcmr_workplaces, gcmr_residential, income, region)}

europe_list=c("Albania","Andorra","Armenia","Austria","Azerbaijan","Belarus","Belgium","Bosnia & Herzegovina","Bulgaria","Croatia","Cyprus","Czechia","Denmark","Estonia","Finland","France","Georgia","Germany","Greece","Hungary","Iceland","Ireland","Italy","Kazakhstan","Kosovo","Latvia","Liechtenstein","Lithuania","Luxembourg","Malta","Moldova","Monaco","Montenegro","Netherlands","Macedonia","Norway","Poland","Portugal","Romania","Russia","San Marino","Serbia","Slovakia","Slovenia","Spain","Sweden","Switzerland","Turkey","Ukraine","United Kingdom","Faroe Islands","Gibraltar","Isle of Man","North Macedonia")

NA_list=c("United States","Mexico","Canada","Guatemala","Cuba","Haiti","Dominican Republic","Honduras","El Salvador","Nicaragua","Costa Rica","Panama","Puerto Rico","Jamaica","Trinidad and Tobago","Guadeloupe","Martinique","Bahamas","Belize","Barbarbados","St. Lucia","St. Vincent & Grenadines","U.S. Virgin Islands","Grenada","Antigua & Barbuda","Dominica","Bermuda","Cayman Islands","Greenland","St. Kitts & Nevis","Sint Maarten","Turks & Caicos Islands","Saint Martin","British Virgin Islands","Barbados","Trinidad & Tobago")

SA_list=c("Aruba","Brazil","Colombia","Argentina","Peru","Venezuela","Chile","Ecuador","Bolivia","Paraguay","Uruguay","Guyana","Suriname","French Guiana","Falkland Islands","CuraÃ§ao")

EURUSA.postFeb6 <- {EURUSA %>%
    filter( (date > as.Date("2020-02-06")) ) %>%
    mutate(region=ifelse(country %in% NA_list,"North America",ifelse(country %in% SA_list,"South America",ifelse(country %in% europe_list,"Europe","NON")))) %>%
    na.omit}

EURUSA.postFeb6 = EURUSA.postFeb6[!(EURUSA.postFeb6$region=="NON"),]

mean_ <- function(...) mean(..., na.rm=T)
max_ <- function(...) max(..., na.rm=T)
EURUSA1 = {EURUSA.postFeb6 %>%
    group_by(country) %>% 
    summarise(date = date,
              mean_gcmr_residential = mean_(gcmr_residential),
              mean_gcmr_workplaces = mean_(gcmr_workplaces),
              region = region)}

```

## Activity in residentials places and workplaces in Europe and America
We plot the average percentage change in the frequency of visits to residential places against workplaces for countries in Europe and America from this year (Feb 7 onwards). We look particularly at the trends for Europe, North America and South America.

```{r plot2, message=FALSE, echo=FALSE, warning=FALSE}
library(ggplot2)
EURUSA_home_work <- {EURUSA1 %>% ggplot(aes(x = mean_gcmr_residential,
                                            y = mean_gcmr_workplaces,
                                            color=region))} +
  xlab("Activity in residential (% change from baseline)") +
  ylab("Activity in workplaces (% change from baseline)") +
  ggtitle("Time in workplaces decreases as time in residential places increases",
           subtitle = "Drawn from Google Community Mobility Reports") +
  geom_point() +
  geom_smooth(method = loess)
print(EURUSA_home_work)

```
We see from this plot that as the time spent in workplaces decreases, the time spent in residential places increases, and this is true across the regions.

We look closer at the activity in homes and workplaces for these regions from 1st March - 11th Apr (note: these dates are subject to change from the data we gain from lockdowns). This is because we see a significant increase in activity in residential homes in this time period, as well as a significant decrease in activity in workplaces.


## References

Gassen, 2020, *Download, Tidy and Visualize Covid-19 Related Data*. [online] Available at: <https://joachim-gassen.github.io/tidycovid19/>

Google, 2020. *COVID-19 Community Mobility Report*. [online] Available at: <https://www.google.com/covid19/mobility/>