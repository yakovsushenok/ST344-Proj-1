---
title: "Draft Report"
author: "Team 7"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```

If everyone could put their draft reports in their corresponding sections by Friday 20th Nov Morning for the meeting, that would be great. This document is meant to be the first draft of many and we be by no means complete.

# Introduction (Everyone)

# Section 1: Overview of lockdown (Vincent C)

## Introduction
I will be looking into a few variables related to lockdown measures by Governments and an overview of the COVID-19 impact in the regions of Europe, North America, Central America and South America. The variables that I am interested in at the daily confirmed cases of COVID-19 as a percentage of the population, the number of lockdown measures in place and the total confirmed cases of COVID-19 as a percentage of the population.

```{r step1, warning=FALSE, include=FALSE}
library(readxl)
CovidData <- read.csv("tidycovid19.csv")
```

```{r step2 date setup, message=FALSE, warning=FALSE, include=FALSE}
library(lubridate)
CovidData$date = as.Date(parse_date_time(CovidData$date,orders=c("y","ym","ymd")))

```

```{r step2 obtain cases per day, message=FALSE, warning=FALSE, include=FALSE}
library(dplyr)
firstdiff <- function(x) {
  shifted <- c(0,x[1:(length(x)-1)])
  result = x-shifted
  which_negative = which(result<0)
  result[which_negative] = NA
  return(result)
}

```

```{r step 2 task2, message=FALSE, warning=FALSE, include=FALSE}
library(stringr)
EuropeAmericaDataPostFeb6 <- {CovidData %>% 
    filter( ( str_detect(region, "America") | str_detect(region, "Europe") ) & (date > as.Date("2020-02-06")) )}
```

```{r daily confirmed, include=FALSE}
# Add a column so we can see the daily confirmed cases of covid19
EuropeAmericaDataPostFeb6 <- EuropeAmericaDataPostFeb6 %>% 
  mutate(daily_confirmed = firstdiff(confirmed))
```

## North America and Central America

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(ggplot2)
AmericaData <- EuropeAmericaDataPostFeb6 %>%
  filter(str_detect(region, "America"))

AmericaData <- AmericaData %>% mutate(daily_conf_percentagepop = (daily_confirmed/population)*100)

AmericaData <- AmericaData %>% mutate(confirmed_percentagepop = (confirmed/population)*100)

```



I will be choosing the top 6 countries in North America and Central America by the population, and plotting the daily confirmed cases as a percentage of the population against the date.
```{r echo=FALSE, fig.align="center", message=FALSE, warning=FALSE}
NorthCentralAmericaData <- AmericaData %>% filter(country %in% c("United States", "Mexico", "Canada", "Guatemala", "Cuba", "Haiti"))

TotalNorthCentralAmericaConfirmed_percen <- ggplot(NorthCentralAmericaData, aes(x = date, y = confirmed_percentagepop, color = country)) + geom_line(size = 0.5)

DailyNorthCentralAmericaConfirmed <- ggplot(NorthCentralAmericaData, aes(x = date, y = daily_conf_percentagepop, color = country)) + geom_line(size = 0.5) 


NorthCentralAmericaLockdown <- ggplot(NorthCentralAmericaData, aes(x = date, y = lockdown, color = country)) + geom_line(size = 2)


print(NorthCentralAmericaLockdown)
# print(TotalNorthCentralAmericaConfirmed_percen)
# print(DailyNorthCentralAmericaConfirmed)

library(ggpubr)

ggarrange(DailyNorthCentralAmericaConfirmed, TotalNorthCentralAmericaConfirmed_percen, ncol=2, nrow=1, common.legend = TRUE, legend="bottom")

```
From the graph above, we can see that for the US and Canada their daily confirmed cases were significant in early April. However, for Mexico and Guatemala the daily confirmed cases were larger around May. The reason why the US and Canada have large values for daily confirmed cases is that these countries did not have any lockdown measures at all. Where as, for Haiti, Mexico and Cuba they had lockdowns around April which helped to maintain the cases and make people aware of the severity of COVID-19. Guatemala had their first lockdown later in May.

We can also see the total confirmed cases as a percentage of the population. US and Canada has a huge growth in the number of confirmed cases in comparison to the other countries. It seems that Cuba and Haiti managed to contain COVID-19 well. For Mexico and Guatemala, the lockdown measures seemed to be not as effective in preventing the spread of COVID-19.


## South America
I will be looking at the top 6 countries by population in South America, these are Brazil, Colombia, Argentina, Peru, Venezuela and Chile.

```{r echo=FALSE, message=FALSE, warning=FALSE}
SouthAmericaData <- AmericaData %>% filter(country %in% c("Brazil", "Colombia", "Argentina", "Peru", "Venezuela", "Chile"))

TotalSouthAmericaConfirmed_percen <- ggplot(SouthAmericaData, aes(x = date, y = confirmed_percentagepop, color = country)) + geom_line(size = 0.5)

DailySouthAmericaConfirmed <- ggplot(SouthAmericaData, aes(x = date, y = daily_conf_percentagepop, color = country)) + geom_line(size = 0.5) 


SouthAmericaLockdown <- ggplot(SouthAmericaData, aes(x = date, y = lockdown, color = country)) + geom_line(size = 2)


print(SouthAmericaLockdown)

ggarrange(DailySouthAmericaConfirmed, TotalSouthAmericaConfirmed_percen, ncol=2, nrow=1, common.legend = TRUE, legend="bottom")
```
From these set of graphs we can see that the the number of confirmed COVID-19 cases as a percentage of the population steadily rose later than in North and Central America. The cases started to rising around May. However, all the countries had at least one lockdown in early April, this may be one of the reasons why it impacted the countries in South America later than North and Central America. Looking at the daily confirmed cases as a percentage of the population, we can see a growing increase of the infections in May. There are also huge spikes from Chile and Peru, I suspect that this could be due to the way they report the daily confirmed cases. There is also something quite unexpected in the graph of the number of lockdown measures, as Venezuela is showing a negative number of lockdown measures between mid May to mid August.

## Europe
I will be looking into the top 6 largest countries in Europe by population. I will be investigating the variables such as the daily confirmed cases of COVID-19 as a percentage of the population, the total confirmed cases by population and the the number of lockdown measures. 

```{r echo=FALSE, message=FALSE, warning=FALSE}
EuropeData <- EuropeAmericaDataPostFeb6 %>%
  filter(str_detect(region, "Europe"))

EuropeData <- EuropeData %>% mutate(daily_conf_percentagepop = (daily_confirmed/population)*100)

EuropeData <- EuropeData %>% mutate(confirmed_percentagepop = (confirmed/population)*100)

EuropeData <- EuropeData %>% filter(country %in% c("Russia", "Turkey", "Germany", "France", "United Kingdom", "Italy"))

TotalEuropeConfirmed_percen <- ggplot(EuropeData, aes(x = date, y = confirmed_percentagepop, color = country)) + geom_line(size = 0.5)

DailyEuropeConfirmed <- ggplot(EuropeData, aes(x = date, y = daily_conf_percentagepop, color = country)) + geom_line(size = 0.5)


EuropeLockdown <- ggplot(EuropeData, aes(x = date, y = lockdown, color = country)) + geom_line(size = 2)

print(EuropeLockdown)

ggarrange(DailyEuropeConfirmed, TotalEuropeConfirmed_percen, ncol=2, nrow=1, common.legend = TRUE, legend="bottom")

```

Looking at the daily confirmed COVID-19 cases for Italy that the number of cases were on the rise in mid March. Other countries like France, Germany, United Kingdom and Turkey followed shortly afterwards. The spread of covid-19 for Russia was roughly a month later than the other countries. Looking at the lockdown measures, by the beginning of April all the countries had at least one lockdown measure to help contain covid-19.
 As we look at August we can see another rise in COVID-19 cases, this is where the second wave of COVID-19 occurred in Europe.


# Section 2: Residential and workplace (Becky)

# Section 3: Grocery and pharmancy (Jacob)

# Section 4: Recreation and retail (Vincent P)

# Section 5: Google Trends (Max)

Using [Google Trends](https://trends.google.com/trends/) data on the search volume for various terms, we can investigate the general interest over time. Google Trends is an unbiased sample of Google search data. Itâ€™s anonymised, categorized and aggregated. For the regions we are looking at - Europe, North, Central and South America - the [percentage of population](https://www.internetworldstats.com/) that uses the internet is 88%, 95%, 61% and 72% respectively. This indicates that the search patterns shown by Google Trends may be an accurate representation of the behaviors and interests of these regions.

We will investigate the search terms `restaurants` and `take-out`, the two can be seen as the compliment of one another. We will plot a graph of the average interest for these terms throughout European, North, Central and South American countries. The y axis represents search interest relative to the highest point on the chart for the given region and time. A value of 100 is the peak popularity for the term. A value of 50 means that the term is half as popular.

```{r chunk1}
library(dplyr)
library(readxl)
library(lubridate)
RestaurantTrendData <- read.csv("gt_restaurants.csv")
TakeOutTrendData <- read.csv("gt_take_out.csv")

RestaurantTrendData <- RestaurantTrendData %>%
  mutate(date = as.Date(parse_date_time(RestaurantTrendData$Week,c("d/m/y"))))
TakeOutTrendData <- TakeOutTrendData %>%
  mutate(date = as.Date(parse_date_time(TakeOutTrendData$Week,c("d/m/y"))))

library(ggplot2)
plot_restuarants_trends <- ggplot(RestaurantTrendData, aes(x = date, y = interest)) +
  geom_line(aes(color='red')) +
  geom_line(data=TakeOutTrendData, aes(color='blue', labels='restaurants')) +
  xlab("Date") +
  ylab("Interest") +
  ggtitle("Interest in Restaurants and Take-Out have a inverse relationship", 
          subtitle="Y-axis represents search interest relative to the highest point") +
  scale_x_date(date_breaks = "months", date_labels = "%m-%y") + 
  scale_color_manual(labels = c("take-out", "restaurants"), values = c("blue", "red")) +
  guides(color=guide_legend("Search Term"))


print(plot_restuarants_trends)
```
The plot above shows that the two search terms' interest have an inverse relationship. As we can see, when lockdown and restrictions began to be imposed by governments, consumer interest in `restaurants` decreased whereas interest in `take-out` increased at a similar magnitude. This shows that in lockdowns, consumers are looking to buy more food online, possibly due to sit-in restaurants being closed or people scared to go out in public. This indicates that we, OmniCorp, should focus on online retail and hospitality when lockdown measures are introduced. It is also important to note that the interest in `restaurants` increased back to normal levels almost as fast as it fell. However, it had a smaller, more steady decrease as a second wave of restrictions took place whereas `takeout` did not have a similar magnitude of increase.
# Conclusion (Everyone)